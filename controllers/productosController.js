// üì¶ Importar el modelo que maneja la l√≥gica con MySQL
const ProductosModel = require("../models/productosModel");

// ============================================================
// üü¢ OBTENER TODOS LOS PRODUCTOS
// GET /api/productos
// ============================================================
const getProductos = async (req, res) => {
  try {
    const productos = await ProductosModel.getAll();
    res.status(200).json(productos);
  } catch (error) {
    console.error("‚ùå Error al obtener productos:", error);
    res.status(500).json({ message: "Error al obtener productos", error: error.message });
  }
};

// ============================================================
// üü¢ AGREGAR NUEVO PRODUCTO
// POST /api/productos
// ============================================================
const postProductos = async (req, res) => {
  try {
    const {
      nombre,
      descripcion,
      stock,
      unidad_medida,
      precio_unitario,
      id_categoria,
      id_proveedor,
    } = req.body;

    // Validaci√≥n b√°sica
    if (!nombre || !precio_unitario || !id_categoria || !id_proveedor) {
      return res.status(400).json({ message: "‚ö†Ô∏è Faltan campos obligatorios" });
    }

    // Llamar al modelo para insertar
    const idInsertado = await ProductosModel.postProducto({
      nombre,
      descripcion,
      stock,
      unidad_medida,
      precio_unitario,
      id_categoria,
      id_proveedor,
    });

    res.status(201).json({
      message: "‚úÖ Producto agregado correctamente",
      id_insertado: idInsertado,
    });
  } catch (error) {
    console.error("‚ùå Error al agregar producto:", error);
    res.status(500).json({ message: "Error al agregar producto", error: error.message });
  }
};

// ============================================================
// üü° ACTUALIZAR PRODUCTO
// PUT /api/productos/:id
// ============================================================
const putProductos = async (req, res) => {
  try {
    const { id } = req.params;
    const {
      nombre,
      descripcion,
      stock,
      unidad_medida,
      precio_unitario,
      id_categoria,
      id_proveedor,
    } = req.body;

    const resultado = await ProductosModel.putProducto(
      id,
      nombre,
      descripcion,
      stock,
      unidad_medida,
      precio_unitario,
      id_categoria,
      id_proveedor
    );

    if (resultado === 0) {
      return res.status(400).json({ message: "‚ùå No se pudo actualizar el producto" });
    }

    res.status(200).json({ message: "‚úÖ Producto actualizado correctamente" });
  } catch (error) {
    console.error("‚ùå Error al actualizar producto:", error);
    res.status(500).json({ message: "Error al actualizar producto", error: error.message });
  }
};

// ============================================================
// üî¥ ELIMINAR PRODUCTO
// DELETE /api/productos/:id
// ============================================================
const deleteProductos = async (req, res) => {
  try {
    const { id } = req.params;

    const resultado = await ProductosModel.delProducto(id);

    if (!resultado) {
      return res.status(404).json({ message: "‚ùå Producto no encontrado" });
    }

    res.status(200).json({ message: "‚úÖ Producto eliminado correctamente" });
  } catch (error) {
    console.error("‚ùå Error al eliminar producto:", error);
    res.status(500).json({ message: "Error al eliminar producto", error: error.message });
  }
};

// ============================================================
// üì§ Exportar funciones para usarlas en las rutas
// ============================================================
module.exports = {
  getProductos,
  postProductos,
  putProductos,
  deleteProductos,
};
